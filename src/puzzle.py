from dataclasses import dataclass
from pygame import Surface
from engine import Engine
from tile import *
from entity import PlayerEntity, SnakeEntity, RatEntity
from typing import Any

all_tiles = {
    ".": EmptyTile,
    "#": WallTile,
    "[": LeftVerticalWallTile,
    "]": RightVerticalWallTile,
    "<": CornerLeftTile,
    ">": CornerRightTile,
}

@dataclass
class Puzzle:
    grid: list[str]
    entities: list[tuple[Any, int, int]]

    def make_engine(self, tilemap: Surface) -> Engine:
        width, height = len(self.grid[0]), len(self.grid)
        engine: Engine = Engine(tilemap, width, height)

        # process the grid

        for y, line in enumerate(self.grid):
            for x, char in enumerate(line):
                engine.world[y][x] = all_tiles[char](x, y)

        # add entities

        for e in self.entities:
            t, x, y = e
            engine.entities.append(t(engine, x, y))

        return engine
    
puzzles = [
    Puzzle([
        "<########################################################>",
        "[........................................................]",
        "[........................................................]",
        "[........................................................]",
        "[................<>......................................]",
        "[................##......................................]",
        "[........................................................]",
        "[........................................................]",
        "[........................................................]",
        "[....................................<>..................]",
        "[....................................##..................]",
        "[........................................................]",
        "[........................................................]",
        "[........................................................]",
        "[........................................................]",
        "[...............<>.......................................]",
        "[...............##.......................................]",
        "[........................................................]",
        "[........................................................]",
        "[........................................................]",
        "[........................................................]",
        "[....................................<>..................]",
        "[.....................<#>............##..................]",
        "[.....................[.]................................]",
        "[.....................[.]................................]",
        "[.....................[.]................................]",
        "[.....................[.]................................]",
        "[.....................[.]................................]",
        "[.....................[.]................................]",
        "[.....................###................................]",
        "[........................................................]",
        "[........................................................]",
        "[........................................................]",
        "##########################################################",
    ], [(PlayerEntity, 1, 20)]#, (SnakeEntity, 1, 3), (RatEntity, 6, 8)]
    )
]